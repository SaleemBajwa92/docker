services:
  nginx:
    volumes:
      - ./docker/nginx/conf/default-dev.conf:/etc/nginx/conf.d/default.conf
    ports:
      - "80:8000"
      - "443:443"
    env_file:
      - ./docker/.env.local
    networks:
      - pointeger

  phpfpm:
    env_file:
      - ./docker/.env.local
    networks:
      - pointeger

  phpfpm-xdebug:
#    container_name: albarak-mage-php-xdebug
    image: pointeger/magento-php-xdebug:8.2
    environment:
      - TZ=Asia/Karachi
    volumes:
      - ./src/:/var/www/html
      - ./docker/xdebug/php.ini:/usr/local/etc/php/php.ini
      - sockdata:/sock
    env_file:
      - ./docker/.env.local
      - ./docker/xdebug/.env
    depends_on:
      - db
      - redis
      - elasticsearch
    networks:
      - pointeger

  db:
    ports:
      - "3306:3306"
    env_file: ./docker/db/.env
    networks:
      - pointeger

  adminer:
#    container_name: albarak-mage-adminer
    image: adminer
    ports:
      - 8081:8080
    networks:
      - pointeger

  redis:
    ports:
      - "6379:6379"
    networks:
      - pointeger

  elasticsearch:
    ports:
      - "9200:9200"
      - "9300:9300"
    networks:
      - pointeger

#  opensearch:
#    ports:
#      - "9200:9200"
#      - "9300:9300"
#    env_file: ./docker/opensearch/.env
#    networks:
#      - pointeger
#    ## Uncomment following if you are using Apple M4 based chip and MacOs version 15.2
#    environment:
#     - "_JAVA_OPTIONS=-XX:UseSVE=0"

  mailhog:
    image: mailhog/mailhog
    ports:
      - 587:587
      - 8025:8025
      - 1025:1025
    networks:
      - pointeger

  rabbitmq:
    image: markoshust/magento-rabbitmq:4.1-0
    ports:
      - "15672:15672"
      - "5672:5672"
    env_file: ../docker/compose/docker/rabbitmq/.env
    networks:
      - pointeger

networks:
  pointeger:
    driver: bridge
